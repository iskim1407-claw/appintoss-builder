# 앱인토스 빌더 "원클릭 심사 제출" 아키텍처

> 에디터에서 "제출" 버튼 하나로 앱인토스 심사까지 자동화

**문서 작성일**: 2026-02-13

---

## 📊 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        앱인토스 빌더 (Vercel)                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                        프론트엔드 (Next.js 14)                       │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────────────────┐ │ │
│  │  │   에디터     │→ │  앱 정보 폼  │→ │  심사 체크 + 제출 화면    │ │ │
│  │  │  (Craft.js) │  │  (메타데이터) │  │  (검증 결과 + 가이드)     │ │ │
│  │  └──────────────┘  └──────────────┘  └───────────────────────────┘ │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                    │                                     │
│                                    ▼                                     │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                        API Routes (Serverless)                      │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────────────────┐ │ │
│  │  │ /api/validate│  │ /api/build   │  │ /api/submit-guide         │ │ │
│  │  │ (정책 검증)   │  │ (ZIP 생성)   │  │ (제출 가이드 생성)        │ │ │
│  │  └──────────────┘  └──────────────┘  └───────────────────────────┘ │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                    │                                     │
│                                    ▼                                     │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                           출력물                                     │ │
│  │  ┌──────────────────────┐  ┌──────────────────────────────────────┐│ │
│  │  │  프로젝트 ZIP 다운로드 │  │  단계별 제출 가이드 (스크린샷 포함)    ││ │
│  │  │  (Vite+React+TDS)    │  │  + 복사 가능한 메타데이터              ││ │
│  │  └──────────────────────┘  └──────────────────────────────────────┘│ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ (사용자가 수동으로)
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                     앱인토스 콘솔 (수동 업로드)                          │
│  1. 앱 등록 → 2. 메타 정보 입력 → 3. 번들 업로드 → 4. 검토 요청          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 🔍 기술적 제약 분석

### 1. 앱인토스 API 상황

| 항목 | 상태 | 비고 |
|------|------|------|
| **공개 REST API** | ❌ 없음 | 콘솔 전용, 공개 API 미제공 |
| **번들 업로드 API** | ❌ 없음 | 웹 UI 통해서만 업로드 가능 |
| **Granite CLI** | ✅ 있음 | `granite build` → `.ait` 생성, `granite deploy` → 배포 |
| **CLI 인증** | 토스앱 QR | `granite login` 시 토스앱 QR 스캔 필요 |

**결론**: 앱인토스는 공개 API를 제공하지 않음. 풀 자동화는 불가능.

### 2. Granite CLI 서버사이드 실행 가능성

```bash
# granite build 요구사항
- Node.js 18+
- 프로젝트 디렉토리 내 granite.config.ts
- npm install 필요 (@apps-in-toss/web-framework)
```

| 환경 | 가능 여부 | 제약 |
|------|----------|------|
| **Vercel Serverless** | ⚠️ 제한적 | 50MB 함수 크기, 10초 타임아웃, 파일시스템 제한 |
| **Vercel Edge** | ❌ 불가 | Node.js API 제한 |
| **외부 빌드 서버** | ✅ 가능 | 별도 서버 필요 (비용 발생) |
| **클라이언트 (브라우저)** | ❌ 불가 | CLI 실행 불가 |

**현실적 결론**: 서버사이드에서 granite build 실행은 복잡함. **ZIP 다운로드 → 로컬 빌드** 방식이 MVP에 적합.

### 3. 브라우저 자동화 옵션

| 방식 | 장점 | 단점 | 적합성 |
|------|------|------|--------|
| **Playwright 서버** | 완전 자동화 | 별도 서버, 세션 관리, 토스앱 인증 문제 | ❌ |
| **브라우저 확장** | 사용자 세션 활용 | 설치 필요, 유지보수 부담 | ⚠️ |
| **단계별 가이드** | 구현 간단, 안정적 | 수동 작업 필요 | ✅ MVP |

---

## 🎯 현실적 MVP 제안: "반자동" 방식

### MVP 접근법: 스마트 가이드 시스템

```
┌──────────────────────────────────────────────────────────────────┐
│  "원클릭"의 재정의: 클릭 하나로 "제출 준비"가 완료되는 것        │
│  - 빌드 가능한 프로젝트 ZIP                                      │
│  - 복사-붙여넣기 가능한 메타데이터                               │
│  - 심사 통과를 위한 자동 검증                                    │
│  - 단계별 비주얼 가이드                                          │
└──────────────────────────────────────────────────────────────────┘
```

### 유저 플로우 (MVP)

```
┌────────┐    ┌────────────┐    ┌────────────┐    ┌────────────────┐
│ 에디터  │ →  │ 앱 정보 입력│ →  │ 자동 검증   │ →  │ 제출 패키지     │
│        │    │            │    │            │    │ 다운로드        │
└────────┘    └────────────┘    └────────────┘    └────────────────┘
                                      │
                                      ▼
                              ┌────────────────┐
                              │ 심사 체크 결과  │
                              │ (통과/경고/실패)│
                              └────────────────┘
                                      │
                                      ▼
                              ┌────────────────┐
                              │ 단계별 제출    │
                              │ 가이드 (5단계) │
                              └────────────────┘
```

---

## ✅ 심사 자동 체크 시스템

### 검증 항목 (앱인토스 운영정책 기반)

```typescript
interface ValidationResult {
  passed: boolean;
  score: number;       // 0-100
  category: 'pass' | 'warning' | 'fail';
  items: ValidationItem[];
}

interface ValidationItem {
  id: string;
  name: string;
  status: 'pass' | 'warning' | 'fail';
  message: string;
  fix?: string;        // 자동 수정 가능시
}
```

### 체크리스트

#### 🔴 필수 (실패 시 제출 불가)
| ID | 검증 항목 | 검증 방법 |
|----|----------|----------|
| `REQ-001` | 금지 키워드 체크 | 앱 이름/설명에 "Toss", "Apps-in-Toss", "토스" 포함 여부 |
| `REQ-002` | 금지 카테고리 체크 | 가상자산, 사행성, 데이팅, 불법 콘텐츠 |
| `REQ-003` | appName 형식 | lowercase, hyphen만 허용, 길이 제한 |
| `REQ-004` | 로고 스펙 | 600x600 PNG, 파일 크기 < 500KB |
| `REQ-005` | 부제 길이 | 20자 이하, 비속어/느낌표 제외 |

#### 🟡 권장 (경고, 심사 반려 가능성)
| ID | 검증 항목 | 검증 방법 |
|----|----------|----------|
| `REC-001` | TDS 컴포넌트 사용률 | 전체 컴포넌트 중 TDS 비율 (권장: 80% 이상) |
| `REC-002` | 필수 페이지 존재 | 개인정보처리방침 링크 |
| `REC-003` | 번들 크기 | 압축 해제 기준 100MB 이하 |
| `REC-004` | 이미지 최적화 | 외부 CDN 사용 권장 |
| `REC-005` | 모바일 최적화 | viewport 메타, safe-area 대응 |

#### 🟢 선택 (심사 통과에 직접 영향 없음)
| ID | 검증 항목 | 검증 방법 |
|----|----------|----------|
| `OPT-001` | 접근성 | ARIA 라벨, 색상 대비 |
| `OPT-002` | 성능 힌트 | lazy loading, 코드 스플리팅 |

### TDS 컴포넌트 사용률 계산

```typescript
const TDS_COMPONENTS = [
  'ButtonComponent', 'CardComponent', 'ListRowComponent', 'TabComponent',
  'TabBarComponent', 'NavigationComponent', 'BottomSheetComponent',
  'InputComponent', 'TextFieldComponent', 'ProgressBarComponent',
  'BadgeComponent', 'ToastComponent', 'DividerComponent',
  // 핀테크 컴포넌트 (TDS 준수)
  'PaymentComponent', 'AccountComponent', 'CreditScoreComponent',
  'ProductCompareComponent', 'TransactionListComponent',
];

function calculateTDSUsage(nodes: NodesMap): number {
  const allComponents = Object.values(nodes).filter(n => n.type?.resolvedName !== 'Canvas');
  const tdsComponents = allComponents.filter(n => TDS_COMPONENTS.includes(n.type?.resolvedName));
  return (tdsComponents.length / allComponents.length) * 100;
}
```

---

## 📁 파일 구조

```
src/
├── app/
│   ├── editor/
│   │   └── page.tsx                    # 기존 에디터
│   ├── submit/
│   │   ├── page.tsx                    # 제출 메인 페이지
│   │   ├── components/
│   │   │   ├── AppInfoForm.tsx         # 앱 정보 입력 폼
│   │   │   ├── ValidationPanel.tsx     # 심사 체크 결과
│   │   │   ├── SubmitGuide.tsx         # 단계별 제출 가이드
│   │   │   └── DownloadPackage.tsx     # ZIP 다운로드 버튼
│   │   └── hooks/
│   │       └── useValidation.ts        # 검증 로직 훅
│   └── api/
│       ├── validate/
│       │   └── route.ts                # POST: 심사 검증 API
│       ├── build/
│       │   └── route.ts                # POST: ZIP 생성 API
│       └── submit-guide/
│           └── route.ts                # GET: 가이드 데이터
├── lib/
│   ├── validation/
│   │   ├── index.ts                    # 검증 메인 로직
│   │   ├── rules/
│   │   │   ├── keywords.ts             # 금지 키워드 체크
│   │   │   ├── tdsUsage.ts             # TDS 사용률 체크
│   │   │   ├── metadata.ts             # 메타데이터 검증
│   │   │   └── bundle.ts               # 번들 관련 검증
│   │   └── constants.ts                # 금지 키워드 등 상수
│   ├── aitExportGenerator.ts           # 기존 (수정)
│   └── submitPackageGenerator.ts       # 제출 패키지 생성
├── types/
│   └── submit.ts                       # 제출 관련 타입
└── stores/
    └── submitStore.ts                  # 제출 상태 관리
```

---

## 🛠 기술 스택 결정

| 영역 | 기술 | 이유 |
|------|------|------|
| **프레임워크** | Next.js 14 (App Router) | 기존 유지, API Routes 활용 |
| **상태 관리** | Zustand | 경량, 기존 projectStore와 통일 |
| **폼 관리** | React Hook Form + Zod | 타입 안전한 폼 검증 |
| **ZIP 생성** | JSZip (브라우저) | 서버 부하 없이 클라이언트에서 생성 |
| **UI** | Tailwind + shadcn/ui | 기존 유지 |
| **아이콘** | Lucide React | 경량, 기존 사용 중 |

---

## 📋 MVP 구현 계획

### Phase 1: 심사 체크 시스템 (2일)

| 순서 | 파일 | 설명 | 시간 |
|------|------|------|------|
| 1 | `lib/validation/constants.ts` | 금지 키워드, TDS 목록 등 상수 | 1h |
| 2 | `lib/validation/rules/*.ts` | 개별 검증 규칙 구현 | 3h |
| 3 | `lib/validation/index.ts` | 검증 엔진 통합 | 2h |
| 4 | `types/submit.ts` | 타입 정의 | 1h |
| 5 | `app/api/validate/route.ts` | 검증 API 엔드포인트 | 1h |

### Phase 2: 앱 정보 입력 폼 (2일)

| 순서 | 파일 | 설명 | 시간 |
|------|------|------|------|
| 1 | `stores/submitStore.ts` | 제출 상태 관리 | 2h |
| 2 | `submit/components/AppInfoForm.tsx` | 메타데이터 폼 UI | 4h |
| 3 | `submit/components/ValidationPanel.tsx` | 검증 결과 표시 | 3h |
| 4 | `submit/hooks/useValidation.ts` | 실시간 검증 훅 | 2h |

### Phase 3: 제출 패키지 생성 (2일)

| 순서 | 파일 | 설명 | 시간 |
|------|------|------|------|
| 1 | `lib/submitPackageGenerator.ts` | 메타데이터 포함 ZIP 생성 | 3h |
| 2 | `app/api/build/route.ts` | 빌드 API (선택) | 2h |
| 3 | `submit/components/DownloadPackage.tsx` | 다운로드 UI | 2h |
| 4 | 로고 업로드 + 리사이즈 | 600x600 자동 변환 | 2h |

### Phase 4: 제출 가이드 (1일)

| 순서 | 파일 | 설명 | 시간 |
|------|------|------|------|
| 1 | `submit/components/SubmitGuide.tsx` | 단계별 가이드 UI | 4h |
| 2 | 가이드 콘텐츠 작성 | 스크린샷, 설명 | 2h |
| 3 | 클립보드 복사 기능 | 메타데이터 복사 | 1h |

### Phase 5: 통합 및 테스트 (1일)

| 순서 | 작업 | 시간 |
|------|------|------|
| 1 | `submit/page.tsx` 메인 페이지 조립 | 2h |
| 2 | 에디터 → 제출 플로우 연결 | 2h |
| 3 | E2E 테스트 | 2h |
| 4 | 버그 수정 및 폴리싱 | 2h |

---

## ⏱ 예상 개발 시간

| Phase | 설명 | 시간 |
|-------|------|------|
| Phase 1 | 심사 체크 시스템 | 8h |
| Phase 2 | 앱 정보 입력 폼 | 11h |
| Phase 3 | 제출 패키지 생성 | 9h |
| Phase 4 | 제출 가이드 | 7h |
| Phase 5 | 통합 및 테스트 | 8h |
| **총계** | | **43h (~5-6일)** |

---

## 🚀 로드맵

### MVP (v1.0) - 현재 설계
- ✅ 심사 자동 체크
- ✅ 앱 정보 입력 폼
- ✅ 프로젝트 ZIP 다운로드
- ✅ 단계별 제출 가이드
- 📋 사용자가 로컬에서 `granite build` 후 수동 업로드

### v2.0 - 빌드 서버
- ☐ 외부 빌드 서버 (AWS Lambda 또는 Fly.io)
- ☐ `.ait` 파일 직접 생성 및 다운로드
- ☐ 빌드 로그 실시간 표시
- 📋 여전히 수동 업로드 (API 없음)

### v3.0 - 확장 기능
- ☐ 템플릿 라이브러리 (카테고리별)
- ☐ A/B 테스트용 다중 버전 관리
- ☐ 심사 이력 추적
- ☐ 팀 협업 기능

### v4.0 - (공개 API 출시 시)
- ☐ 완전 자동 제출
- ☐ 심사 상태 실시간 추적
- ☐ 자동 배포

---

## 🎨 UI 와이어프레임

### 제출 페이지 레이아웃

```
┌─────────────────────────────────────────────────────────────────┐
│  ← 에디터로 돌아가기                           앱인토스 제출하기 │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────┬────────────────────────────┤
│  │                                 │                             │
│  │      📋 앱 정보 입력            │      ✅ 심사 체크 결과       │
│  │                                 │                             │
│  │  ┌───────────────────────────┐ │   ┌───────────────────────┐ │
│  │  │ 앱 이름 (한국어)          │ │   │ ✅ 금지 키워드 통과   │ │
│  │  │ [                       ] │ │   │ ✅ 앱 이름 형식 OK    │ │
│  │  └───────────────────────────┘ │   │ ⚠️ TDS 사용률 72%     │ │
│  │                                 │   │ ✅ 로고 스펙 OK       │ │
│  │  ┌───────────────────────────┐ │   │ ❌ 부제 21자 초과     │ │
│  │  │ 앱 이름 (영문, appName)   │ │   └───────────────────────┘ │
│  │  │ [                       ] │ │                             │
│  │  └───────────────────────────┘ │   심사 예상 점수: 85/100    │
│  │                                 │   🟢 제출 가능              │
│  │  ┌───────────────────────────┐ │                             │
│  │  │ 카테고리                   │ │                             │
│  │  │ [ 생활 > 일상 > 테스트  ▼] │ │                             │
│  │  └───────────────────────────┘ │                             │
│  │                                 │                             │
│  │  ┌───────────────────────────┐ │                             │
│  │  │ 부제 (20자 이내)          │ │                             │
│  │  │ [                       ] │ │                             │
│  │  └───────────────────────────┘ │                             │
│  │                                 │                             │
│  │  ┌───────────────────────────┐ │                             │
│  │  │ 로고 (600x600 PNG)        │ │                             │
│  │  │  ┌─────┐                  │ │                             │
│  │  │  │ 📷  │ 이미지 업로드    │ │                             │
│  │  │  └─────┘                  │ │                             │
│  │  └───────────────────────────┘ │                             │
│  │                                 │                             │
│  └─────────────────────────────────┴────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                     📦 제출 패키지 다운로드                  ││
│  │                                                              ││
│  │   [프로젝트 ZIP 다운로드]  [제출 가이드 보기]                ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📚 참고 자료

- [앱인토스 개발자센터](https://developers-apps-in-toss.toss.im/)
- [앱인토스 비게임 출시 가이드](https://developers-apps-in-toss.toss.im/checklist/app-nongame.html)
- [앱인토스 운영 정책](https://developers-apps-in-toss.toss.im/policy/)
- [TDS Mobile 문서](https://tossmini-docs.toss.im/tds-mobile/)

---

## 🔑 핵심 인사이트

1. **공개 API 없음** - 앱인토스는 콘솔 UI 기반. 풀 자동화 불가능.

2. **반자동이 최선** - "제출 준비"를 자동화하고, 실제 업로드는 가이드로 안내.

3. **심사 체크가 핵심 가치** - 제출 전 문제를 발견하면 반려 횟수 감소.

4. **TDS 사용률 강조** - 앱인토스 심사에서 TDS 준수는 중요한 기준.

5. **MVP 5-6일** - 핵심 기능만 집중하면 빠르게 출시 가능.

---

*이 문서는 앱인토스 빌더의 "원클릭 제출" 기능 설계를 위해 작성되었습니다.*
